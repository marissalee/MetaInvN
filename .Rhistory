theme(plot.margin = unit(c(top,right,bottom,left),"in")),
DIFFlist[['figures']][['littercn']][['nh']] + ggtitle('d') +
theme(plot.margin = unit(c(top,right,bottom,left),"in")),
DIFFlist[['figures']][['litterpercN']][['toti']] + ggtitle('b') +
theme(plot.margin = unit(c(top,right,bottom,left),"in")),
DIFFlist[['figures']][['littercn']][['toti']] + ggtitle('e') +
theme(plot.margin = unit(c(top,right,bottom,left),"in")),
DIFFlist[['figures']][['litterpercN']][['nminz']] + ggtitle('c')+
theme(plot.margin = unit(c(top,right,bottom,left),"in")),
DIFFlist[['figures']][['littercn']][['nminz']] + ggtitle('f') +
theme(plot.margin = unit(c(top,right,bottom,left),"in")),
nrow=3, ncol=2),
textGrob(" "), #bottom left
xlabel, #bottom right
widths = unit.c(unit(2.5, "lines"), unit(1, "npc") - unit(2.5, "lines")),
heights = unit.c(unit(1, "npc") - unit(2.5, "lines"), unit(2.5, "lines")),
nrow=2, ncol=2)
dev.off()
#add panel labels
INVlist1<-AddPanelTitles(INVlist)
NATlist1<-AddPanelTitles(NATlist)
DIFFlist1<-AddPanelTitles(DIFFlist)
#plot and save
PLANTlist<-list(INVlist1, NATlist1, DIFFlist1)
PLANTlabel<-c('INV','NAT','DIFF')
xlabel.PlantText<-c('Invasive species','Reference area','Invaded - Reference area')
l<-0
for(l in 1:length(PLANTlist)){
i<-0
for (i in 1:length(TRAIT)){
CURRTRAIT<-PLANTlist[[l]][[i]]
xlabel<- textGrob(paste(xlabel.PlantText[l],TRAIT[i], sep=", "), x=0.5, y=unit(1,'lines'))
#open image file connection
newfilename<-paste(paste(PLANTlabel[l],TRAIT[i], sep="_"),'.png',sep="")
png(paste(figuresPath,newfilename, sep='/'), units='in',
width = fig.width*3.5, height = fig.height*3.5, res=fig.res)
grid.arrange(
textGrob('Std. Mean Diff. (Inv-Ref)', y=0.5,x=unit(1,'lines'), rot=90), # ylabel topleft
do.call(arrangeGrob,  CURRTRAIT),
textGrob(" "), #bottom left
xlabel, #bottom right
widths = unit.c(unit(2.5, "lines"), unit(1, "npc") - unit(2.5, "lines")),
heights = unit.c(unit(1, "npc") - unit(2.5, "lines"), unit(2.5, "lines")),
nrow=2, ncol=2
)
dev.off()
}
}
TRAIT
PLANTlist<-list(INVlist1, NATlist1, DIFFlist1)
PLANTlabel<-c('INV','NAT','DIFF')
xlabel.PlantText<-c('Invasive species','Reference area','Invaded - Reference area')
xlabel.TraitText<-c('Leaf %N','Litter %N','Leaf C:N','Litter C:N')
l<-0
for(l in 1:length(PLANTlist)){
i<-0
for (i in 1:length(TRAIT)){
CURRTRAIT<-PLANTlist[[l]][[i]]
xlabel<- textGrob(paste(xlabel.PlantText[l],xlabel.TraitText[i], sep=", "), x=0.5, y=unit(1,'lines'))
#open image file connection
newfilename<-paste(paste(PLANTlabel[l],TRAIT[i], sep="_"),'.png',sep="")
png(paste(figuresPath,'allRegressionPlots',newfilename, sep='/'), units='in',
width = fig.width*3.5, height = fig.height*3.5, res=fig.res)
grid.arrange(
textGrob('Std. Mean Diff. (Inv-Ref)', y=0.5,x=unit(1,'lines'), rot=90), # ylabel topleft
do.call(arrangeGrob,  CURRTRAIT),
textGrob(" "), #bottom left
xlabel, #bottom right
widths = unit.c(unit(2.5, "lines"), unit(1, "npc") - unit(2.5, "lines")),
heights = unit.c(unit(1, "npc") - unit(2.5, "lines"), unit(2.5, "lines")),
nrow=2, ncol=2
)
dev.off()
}
}
currMeasFac<-anovaMods[anovaMods$anovaLabels=='ecosystA' & anovaMods$pval < 0.05,'.id']
currMeasFac
#levels(dat.tmp$ecosystCat) #check to make sure that this lines up with the way I organized the contrasts
#Run post-hoc comparisions among Nfix levels, pull out means and CI
i<-0
posthoc.list<-list()
pred.list<-list()
for(i in 1:length(currMeasFac)){
#1. calc posthoc pvals
# forest, shrubland, grassland, wetland
posthocR<-anova(res.ecosyst[[currMeasFac[i]]],
L=rbind(c(1,-1,0,0), #forest vs shrub
c(1,0,-1,0), #forest vs grass
c(1,0,0,-1), #forest vs wet
c(0,1,-1,0), #shrub vs grass
c(0,1,0,-1), #shrub vs wet
c(0,0,1,-1) #grass vs wet
))
levelcomp<-c('f_s','f_g','f_w',
's_g','s_w',
'g_w')
posthoc.list[[i]]<-data.frame(levelcomp, pval=round(posthocR$pval, digits=4))
#2. calc predicted values by level
predR<-predict(res.ecosyst[[currMeasFac[i]]])
tmp<-data.frame(obsID=predR$slab, pred=predR$pred, cilb=predR$ci.lb, ciub=predR$ci.ub, se=predR$se)
ind.Fac<-ddply(dat.tmp, ~obsID, summarize, Level=unique(ecosystCat))
tmp1<-merge(tmp, ind.Fac)
tmp2<-ddply(tmp1, ~Level, summarize,
pred = unique(pred),
cilb = unique(cilb),
ciub = unique(ciub),
se = unique(se),
k = length(obsID))
pred.list[[i]]<-tmp2
}
names(posthoc.list)<-currMeasFac
posthocR<-ldply(posthoc.list)
posthocR
names(pred.list)<-currMeasFac
predR<-ldply(pred.list)
predR
#update effect size table for plotting
colnames(predR)[1]<-'MeasFac'
selectMeas<-unique(predR$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
colnames(predR)[2]<-'CAT'
CAT<-levels(dat.tmp$ecosystCat)
predR$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
predR[predR$CAT==CAT[1] & predR$MeasFac==MeasFacl[i],'y']<-i+0.3
predR[predR$CAT==CAT[2] & predR$MeasFac==MeasFacl[i],'y']<-i+0.1
predR[predR$CAT==CAT[3] & predR$MeasFac==MeasFacl[i],'y']<-i-0.1
predR[predR$CAT==CAT[4] & predR$MeasFac==MeasFacl[i],'y']<-i-0.3
}
predR
#assign post-hoc letters (order:f, s, g, w)
#subset(posthocR, .id=='soiln')
phTammonif<-c('a','b','b','b')
phTsoiln<-c('b','bc','a','ac') #check this one
predR$posthocL<-c(phTammonif,phTsoiln)
#assign pretty names and symbols
faclimits<-rev(c('Wetland','Grassland','Shrubland','Forest'))
facShapes<-c(16,17,15,18)
predR$annLabel<-paste(predR$posthocL, ' (',predR$k,')', sep='')
#ggplot
eco.sp<-ggplot(data=predR,aes(x=pred,y=y, shape=CAT,label=annLabel)) +
geom_point(aes(shape=CAT),size=3) +
geom_errorbarh(aes(xmin=cilb,xmax=ciub), height=0)+
geom_vline(xintercept=0,linetype="dashed") + mytheme +
xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
scale_y_continuous(breaks=seq(1,length(MeasFacl)),
labels=MeasNamesl) +
scale_shape_manual(name="Factor",
labels=faclimits,
values=facShapes)+
geom_text(aes(x=ciub, y=y, hjust=-0.3, vjust=0.5),size=2.2,show_guide = FALSE) +
scale_x_continuous(expand=c(0,0), limits=c(-1.1,2))
eco.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
newfilename<-"ecosystForest.png"
png(paste(figuresPath,'modForestPlots',newfilename, sep='/'), units='in', width = fig.width*1.5, height = fig.height*1.5, res=fig.res)
eco.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
dev.off()
currMeasFac<-anovaMods[anovaMods$anovaLabels=='studytypeA' & anovaMods$pval < 0.05,'.id']
currMeasFac
#Run post-hoc comparisions among Study type levels, pull out means and CI
i<-0
posthoc.list<-list()
pred.list<-list()
for(i in 1:length(currMeasFac)){
#1. calc posthoc pvals
posthocR<-anova(res.studytype[[currMeasFac[i]]],
L=rbind(c(1,-1,0,0), #fs vs ea
c(1,0,-1,0), #fs vs er
c(1,0,0,-1), #fs vs gh
c(0,1,-1,0), #ea vs er
c(0,1,0,-1), #ea vs gh
c(0,0,1,-1)  #er vs gh
))
levelcomp<-c('fs_ea','fs_er','fs_gh','ea_er','ea_gh','er_gh')
posthoc.list[[i]]<-data.frame(levelcomp, pval=round(posthocR$pval, digits=4))
#2. calc predicted values by level
predR<-predict(res.studytype[[currMeasFac[i]]])
tmp<-data.frame(obsID=predR$slab, pred=predR$pred,
cilb=predR$ci.lb, ciub=predR$ci.ub, se=predR$se)
ind.studyType<-ddply(dat.tmp, ~obsID, summarize, studyType1=unique(studyType))
tmp1<-merge(tmp, ind.studyType)
tmp2<-ddply(tmp1, ~studyType1, summarize,
pred = unique(pred),
cilb = unique(cilb),
ciub = unique(ciub),
se = unique(se),
k = length(obsID))
pred.list[[i]]<-tmp2
}
names(posthoc.list)<-currMeasFac
posthocR<-ldply(posthoc.list)
posthocR
names(pred.list)<-currMeasFac
predR<-ldply(pred.list)
predR
#update effect size table for plotting
colnames(predR)[1]<-'MeasFac'
selectMeas<-unique(predR$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
colnames(predR)[2]<-'CAT'
CAT<-levels(dat$studyType)
predR$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
predR[predR$CAT==CAT[1] & predR$MeasFac==MeasFacl[i],'y']<-i+0.3
predR[predR$CAT==CAT[2] & predR$MeasFac==MeasFacl[i],'y']<-i+0.1
predR[predR$CAT==CAT[3] & predR$MeasFac==MeasFacl[i],'y']<-i-0.1
predR[predR$CAT==CAT[4] & predR$MeasFac==MeasFacl[i],'y']<-i-0.3
}
predR
#assign post-hoc letters (order:field study, expt addition, expt removl, gh)
#subset(posthocR, .id=='biom')
phTno<-c('a','b','b','b')
phTsom<-c('','','','')
predR$posthocL<-c(phTno,phTsom)
#assign pretty names and symbols
faclimits<-rev(c('Greenhouse study',
'Removal expt',
'Addition expt',
'Observational study'))
facShapes<-c(16,17,15,18)
predR$annLabel<-paste(predR$posthocL, ' (',predR$k,')', sep='')
#ggplot
predR1<-predR #get rid of the CIs for a level with only 1 data point
predR1[predR1$MeasFac == 'som' & predR1$CAT == 'field expt addition',c('cilb','ciub')]<-NA
stud.sp<-ggplot(data=predR1,aes(x=pred,y=y, shape=CAT, label=annLabel)) +
geom_point(aes(shape=CAT),size=3) +
geom_errorbarh(aes(xmin=cilb,xmax=ciub), height=0)+
geom_vline(xintercept=0,linetype="dashed") + mytheme +
xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
scale_y_continuous(breaks=c(1,2),labels=MeasNamesl) +
scale_shape_manual(name="Factor",
labels=faclimits,
values=facShapes)+
geom_text(aes(x=ciub, y=y, hjust=-0.3, vjust=0.5),size=2.2,show_guide = FALSE) +
annotate("text", x=1, y=1.1, label=' (1)', size=2.2)+ #manually add the posthoc letters and k here
scale_x_continuous(expand=c(0,0), limits=c(-1.5,5.3))
stud.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
newfilename<-"studytypeForest.png"
png(paste(figuresPath,'modForestPlots',newfilename, sep='/'), units='in', width = fig.width*2, height = fig.height*1.5, res=fig.res)
stud.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
dev.off()
currMeasFac<-anovaMods[anovaMods$anovaLabels=='NfixA' & anovaMods$pval < 0.05,'.id']
currMeasFac
#levels(dat.tmp$Nfix) #check to make sure that this lines up with the way I organized the contrasts
#Run post-hoc comparisions among Nfix levels, pull out means and CI
i<-0
posthoc.list<-list()
pred.list<-list()
for(i in 1:length(currMeasFac)){
#1. calc posthoc pvals
posthocR<-anova(res.Nfix[[currMeasFac[i]]],
L=rbind(c(1,-1,0,0), #I-R- vs I-R+
c(1,0,-1,0), #I-R- vs I+R-
c(1,0,0,-1), #I-R- vs I+R+
c(0,1,-1,0), #I-R+ vs I+R-
c(0,1,0,-1), #I-R+ vs I+R+
c(0,0,1,-1)  #I+R- vs I+R+
))
levelcomp<-c('none_r','none_i','none_both','r_i','r_both','i_both')
posthoc.list[[i]]<-data.frame(levelcomp, pval=round(posthocR$pval, digits=4))
#2. calc predicted values by level
predR<-predict(res.Nfix[[currMeasFac[i]]])
tmp<-data.frame(obsID=predR$slab, pred=predR$pred, cilb=predR$ci.lb, ciub=predR$ci.ub, se=predR$se)
ind.Fac<-ddply(dat.tmp, ~obsID, summarize, Level=unique(Nfix))
tmp1<-merge(tmp, ind.Fac)
tmp2<-ddply(tmp1, ~Level, summarize,
pred = unique(pred),
cilb = unique(cilb),
ciub = unique(ciub),
se = unique(se),
k = length(obsID))
pred.list[[i]]<-tmp2
}
names(posthoc.list)<-currMeasFac
posthocR<-ldply(posthoc.list)
posthocR
names(pred.list)<-currMeasFac
predR<-ldply(pred.list)
predR
#update effect size table for plotting
colnames(predR)[1]<-'MeasFac'
selectMeas<-unique(predR$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
colnames(predR)[2]<-'CAT'
CAT<-levels(dat$Nfix)
predR$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
predR[predR$CAT==CAT[1] & predR$MeasFac==MeasFacl[i],'y']<-i+0.3
predR[predR$CAT==CAT[2] & predR$MeasFac==MeasFacl[i],'y']<-i+0.1
predR[predR$CAT==CAT[3] & predR$MeasFac==MeasFacl[i],'y']<-i-0.1
predR[predR$CAT==CAT[4] & predR$MeasFac==MeasFacl[i],'y']<-i-0.3
}
predR
#assign post-hoc letters (order:field study, expt addition, expt removl, gh)
#subset(posthocR, .id=='litterbiom')
phTtoti<-c('b','a','b','b')
phTsoiln<-c('a','a','b','a') #check this one
phTsoilcn<-c('a','b','a','a')
predR$posthocL<-c(phTtoti,phTsoiln, phTsoilcn)
#assign pretty names and symbols
faclimits<-unique(predR$CAT)
facShapes<-c(16,17,15,18)
predR$annLabel<-paste(predR$posthocL, ' (',predR$k,')', sep='')
#ggplot
nfix.sp<-ggplot(data=predR,aes(x=pred,y=y, shape=CAT,label=annLabel)) +
geom_point(aes(shape=CAT),size=3) +
geom_errorbarh(aes(xmin=cilb,xmax=ciub), height=0)+
geom_vline(xintercept=0,linetype="dashed") + mytheme +
xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
scale_y_continuous(breaks=seq(1,length(MeasFacl)),
labels=MeasNamesl) +
scale_shape_manual(name="Factor",
labels=faclimits,
values=facShapes)+
geom_text(aes(x=ciub, y=y, hjust=-0.3, vjust=0.5),size=2.2,show_guide = FALSE) +
scale_x_continuous(expand=c(0,0), limits=c(-1.3,2.3))
nfix.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
newfilename<-"nfixForest.png"
png(paste(figuresPath,'modForestPlots',newfilename, sep='/'), units='in', width = fig.width*2, height = fig.height*2, res=fig.res)
nfix.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
dev.off()
currMeasFac<-anovaMods[anovaMods$anovaLabels=='qualityA' & anovaMods$pval < 0.05,'.id']
currMeasFac
#note - som doesn't have all levels of measQuality, so you need to have a different set of contrasts
#levels(dat.tmp$measQuality) #check to make sure that this lines up with the way I organized the contrasts
#Run post-hoc comparisions among Nfix levels, pull out means and CI
i<-0
posthoc.list<-list()
pred.list<-list()
for(i in 1:length(currMeasFac)){
#1. calc posthoc pvals
if(i %in% c(1,2)){
posthocR<-anova(res.quality[[currMeasFac[i]]],
# A+C+, A+C-, A-C+, A-C-
L=rbind(c(1,-1,0,0), #A+C+ vs A+C-
c(1,0,-1,0), #A+C+ vs A-C+
c(1,0,0,-1), #A+C+ vs A-C-
c(0,1,-1,0), #A+C- vs A-C+
c(0,1,0,-1), #A+C- vs A-C-
c(0,0,1,-1)  #A-C+ vs A-C-
))
levelcomp<-c('both_a','both_c','both_none','a_c','a_none','c_none')
posthoc.list[[i]]<-data.frame(levelcomp, pval=round(posthocR$pval, digits=4))
}else{
temp1<-subset(dat.tmp, measCat=='som')
unique(temp1$measQuality)
#levels: A+C-, A-C+, A-C-
posthocR<-anova(res.quality[[currMeasFac[i]]],
L=rbind(c(1,-1,0), #A+C- vs A-C+
c(1,0,-1), #A+C- vs A-C-
c(0,1,-1)  #A-C+ vs A-C-
))
levelcomp<-c('a_c','a_none','c_none')
posthoc.list[[i]]<-data.frame(levelcomp, pval=round(posthocR$pval, digits=4))
}
#2. calc predicted values by level
predR<-predict(res.quality[[currMeasFac[i]]])
tmp<-data.frame(obsID=predR$slab, pred=predR$pred, cilb=predR$ci.lb, ciub=predR$ci.ub, se=predR$se)
ind.Fac<-ddply(dat.tmp, ~obsID+measCat, summarize, Level=measQuality)
ind.Fac.sub<-subset(ind.Fac, measCat==currMeasFac[i])
tmp1<-merge(tmp, ind.Fac.sub)
tmp2<-ddply(tmp1, ~Level, summarize,
pred = unique(pred),
cilb = unique(cilb),
ciub = unique(ciub),
se = unique(se),
k = length(obsID))
pred.list[[i]]<-tmp2
}
names(posthoc.list)<-currMeasFac
posthocR<-ldply(posthoc.list)
posthocR
names(pred.list)<-currMeasFac
predR<-ldply(pred.list)
predR
#update effect size table for plotting
colnames(predR)[1]<-'MeasFac'
selectMeas<-unique(predR$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
colnames(predR)[2]<-'CAT'
CAT<-levels(dat$measQuality)
predR$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
predR[predR$CAT==CAT[1] & predR$MeasFac==MeasFacl[i],'y']<-i+0.3
predR[predR$CAT==CAT[2] & predR$MeasFac==MeasFacl[i],'y']<-i+0.1
predR[predR$CAT==CAT[3] & predR$MeasFac==MeasFacl[i],'y']<-i-0.1
predR[predR$CAT==CAT[4] & predR$MeasFac==MeasFacl[i],'y']<-i-0.3
}
predR
#assign post-hoc letters (order ex:both, a, c, none)
#subset(posthocR, .id=='som')
phTnitrif<-c('','','','') #both vs c is marginally signif (p=0.059)
phTnminz<-c('ab','ab','b','a') #both vs c is marginally signif (p=0.080), c vs none is signif (p=0.038)
phTsom<-c('ab','a','b') #c vs none pval=0.0128
predR$posthocL<-c(phTnitrif,phTnminz, phTsom)
#assign pretty names and symbols
faclimits<-rev(c('No Manipulation','Units Converted',
'Values Aggregated','Units Converted &\nValues Aggregated'))
facShapes<-c(16,17,15,18)
predR$annLabel<-paste(predR$posthocL, ' (',predR$k,')', sep='')
#ggplot
qual.sp<-ggplot(data=predR,aes(x=pred,y=y, shape=CAT,label=annLabel)) +
geom_point(aes(shape=CAT),size=3) +
geom_errorbarh(aes(xmin=cilb,xmax=ciub), height=0)+
geom_vline(xintercept=0,linetype="dashed") + mytheme +
xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
scale_shape_manual(name="Factor",
labels=faclimits,
values=facShapes) +
scale_y_continuous(breaks=seq(1,length(MeasFacl)),
labels=MeasNamesl) +
geom_text(aes(x=ciub, y=y, hjust=-0.3, vjust=0.5),size=2.2,show_guide = FALSE) +
scale_x_continuous(expand=c(0,0),limits=c(-3,2.3))
qual.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
newfilename<-"qualityForest.png"
png(paste(figuresPath,'modForestPlots',newfilename, sep='/'), units='in', width = fig.width*2, height = fig.height*2, res=fig.res)
qual.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
dev.off()
```
currMeasFac<-anovaMods[anovaMods$anovaLabels=='ecosystA' & anovaMods$pval < 0.05,'.id']
currMeasFac
#levels(dat.tmp$ecosystCat) #check to make sure that this lines up with the way I organized the contrasts
#Run post-hoc comparisions among Nfix levels, pull out means and CI
i<-0
posthoc.list<-list()
pred.list<-list()
for(i in 1:length(currMeasFac)){
#1. calc posthoc pvals
# forest, shrubland, grassland, wetland
posthocR<-anova(res.ecosyst[[currMeasFac[i]]],
L=rbind(c(1,-1,0,0), #forest vs shrub
c(1,0,-1,0), #forest vs grass
c(1,0,0,-1), #forest vs wet
c(0,1,-1,0), #shrub vs grass
c(0,1,0,-1), #shrub vs wet
c(0,0,1,-1) #grass vs wet
))
levelcomp<-c('f_s','f_g','f_w',
's_g','s_w',
'g_w')
posthoc.list[[i]]<-data.frame(levelcomp, pval=round(posthocR$pval, digits=4))
#2. calc predicted values by level
predR<-predict(res.ecosyst[[currMeasFac[i]]])
tmp<-data.frame(obsID=predR$slab, pred=predR$pred, cilb=predR$ci.lb, ciub=predR$ci.ub, se=predR$se)
ind.Fac<-ddply(dat.tmp, ~obsID, summarize, Level=unique(ecosystCat))
tmp1<-merge(tmp, ind.Fac)
tmp2<-ddply(tmp1, ~Level, summarize,
pred = unique(pred),
cilb = unique(cilb),
ciub = unique(ciub),
se = unique(se),
k = length(obsID))
pred.list[[i]]<-tmp2
}
names(posthoc.list)<-currMeasFac
posthocR<-ldply(posthoc.list)
posthocR
names(pred.list)<-currMeasFac
predR<-ldply(pred.list)
predR
#update effect size table for plotting
colnames(predR)[1]<-'MeasFac'
selectMeas<-unique(predR$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
colnames(predR)[2]<-'CAT'
CAT<-levels(dat.tmp$ecosystCat)
predR$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
predR[predR$CAT==CAT[1] & predR$MeasFac==MeasFacl[i],'y']<-i+0.3
predR[predR$CAT==CAT[2] & predR$MeasFac==MeasFacl[i],'y']<-i+0.1
predR[predR$CAT==CAT[3] & predR$MeasFac==MeasFacl[i],'y']<-i-0.1
predR[predR$CAT==CAT[4] & predR$MeasFac==MeasFacl[i],'y']<-i-0.3
}
predR
#assign post-hoc letters (order:f, s, g, w)
#subset(posthocR, .id=='soiln')
phTammonif<-c('a','b','b','b')
phTsoiln<-c('b','bc','a','ac') #check this one
predR$posthocL<-c(phTammonif,phTsoiln)
#assign pretty names and symbols
faclimits<-rev(c('Wetland','Grassland','Shrubland','Forest'))
facShapes<-c(16,17,15,18)
predR$annLabel<-paste(predR$posthocL, ' (',predR$k,')', sep='')
#ggplot
eco.sp<-ggplot(data=predR,aes(x=pred,y=y, shape=CAT,label=annLabel)) +
geom_point(aes(shape=CAT),size=3) +
geom_errorbarh(aes(xmin=cilb,xmax=ciub), height=0)+
geom_vline(xintercept=0,linetype="dashed") + mytheme +
xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
scale_y_continuous(breaks=seq(1,length(MeasFacl)),
labels=MeasNamesl) +
scale_shape_manual(name="Factor",
labels=faclimits,
values=facShapes)+
geom_text(aes(x=ciub, y=y, hjust=-0.3, vjust=0.5),size=2.2,show_guide = FALSE) +
scale_x_continuous(expand=c(0,0), limits=c(-1.1,2))
eco.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
newfilename<-"ecosystForest.png"
png(paste(figuresPath,'modForestPlots',newfilename, sep='/'), units='in', width = fig.width*1.5, height = fig.height*1.5, res=fig.res)
eco.sp + theme(axis.text.y=element_text(angle=90, hjust=0.5, size=10))
dev.off()
source('~/.active-rstudio-document', echo=TRUE)
