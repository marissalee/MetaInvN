---
title: Meta-analysis of invasive speciesâ€™ impacts on N cycling (MIIN) - results of
  paperData and TRY data
author: "Marissa Lee"
date: "January 21, 2015"
output: pdf_document
---

*Filename: MIIN_results.Rmd'*  
```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE)
```

```{r load,echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(gridExtra)
library(plyr)
library(reshape2)
library(metafor)
source('rmdCode/mytheme.R')

dat<-read.table("synthesizedData/clean/forAnalysis.txt", header=TRUE, sep="\t")

## Set up the order of measurement types ######################################################

MEASCAT<-c('nh','no','toti',
           'ammonif','nitrif','nminz',
           'soiln','soilcn',
           'som','biom','litterbiom',
           'percN','cn','litterpercN','littercn')
labels <- c("Ammonium", "Nitrate", "Total inorganic N", 
            "Ammonification","Nitrification","Mineralization",
            "Soil N","Soil C:N",
            "Soil organic matter","Plant biomass","Litter biomass",
            "Leaf %N","Leaf C:N","Litter %N","Litter C:N")
measTab<-data.frame(MEASCAT,labels)
measTab

## Do some cleaning for the factor analyses ######################################################

#Quality
dat$CWMDiff_qualRank<-dat$InvArea_qualRank+dat$NatArea_qualRank
dat$InvSpInvArea_qualRank<-factor(dat$InvSpInvArea_qualRank)
dat$NatArea_qualRank<-factor(dat$NatArea_qualRank)
dat$CWMDiff_qualRank<-factor(dat$CWMDiff_qualRank)

#Ecosystem
unique(dat$ecosystCat)
dat$ecosystCat <- factor(dat$ecosystCat, 
                         levels = c("forest", 
                                    "shrubland", 
                                    "grassland", 
                                    "wetland",
                                    "other"))

#Study type
unique(dat$studyType)
dat$studyType <- factor(dat$studyType, 
                         levels = c("field study", 
                                    "field expt addition", 
                                    "field expt removal", 
                                    "greenhouse expt"))

#Legume status
unique(dat$InvLeg)
dat$InvLeg<-revalue(dat$InvLeg, c("Legume"="InvPres", "Non-legume"="InvAbs"))
unique(dat$NatLeg)
dat$NatLeg<-revalue(dat$NatLeg, c("Legumes present"="RefPres", "Legumes absent"="RefAbs"))
dat$Leg<-paste(dat$InvLeg,dat$NatLeg, sep="_")
unique(dat$Leg)
dat$Leg <- factor(dat$Leg, 
                  levels = c("InvAbs_RefAbs",
                             "InvAbs_RefPres",
                             "InvPres_RefAbs",
                             "InvPres_RefPres"))

#data structure
summ<-ddply(dat, ~measCat+traitCat, summarize,
                 nRows = length(obsID),
                 uniqueObs = length(unique(obsID)))
#summ
```

#1. Global effect sizes

##A. Fit 3-level random-effects model and view likelihood plots  
Model syntax is res <- rma.mv(yi, vi, random=list(~1 | paperID, ~1 | obsID), data=dat1, subset=measCat==MEASCAT[i], slab=paste(paperID,obsID, sep=","))
```{r baseMod,echo=FALSE, warning=FALSE, message=FALSE}
### fit 3-level random-effects models to some subsets
dat.meas<-ddply(dat, ~obsID+measCat, summarize,
                yi = unique(yi),
                vi = unique(vi),
                paperID = unique(paperID))
colnames(dat.meas)

res.list<-list()
i<-0
for(i in 1:length(MEASCAT)){
  res <- rma.mv(yi, vi, 
                random=list(~1 | paperID, ~1 | obsID), 
                data=dat.meas, subset=measCat==MEASCAT[i], 
                slab=as.character(obsID))
  res.list[[i]]<-res
  print(paste(i, 'of', length(MEASCAT)))
}
names(res.list)<-MEASCAT
#warnings() #these should all just say 'Rows with NAs omitted from model fitting'

# #View profile likelihood plots
# par(mfrow=c(2,1))
# i<-0
# for(i in 1:length(res.list)){
#   res<-res.list[[i]]
#   profile(res, sigma2=1)
#   mtext(labels[i])
#   profile(res, sigma2=2)
#   mtext(labels[i])
# }
#if both have 1 peak, we can be sure that both variance components are identifiable

```

##B. Make global forest plot, save estimates and pvals
```{r baseForest,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
#plot
est.list<-list()
var.list<-list()
cil.list<-list()
ciu.list<-list()
k.list<-list()
i<-0
for(i in 1:length(MEASCAT)){
  est.list[[i]]<-coef(res.list[[as.character(MEASCAT[i])]])
  var.list[[i]]<-vcov(res.list[[as.character(MEASCAT[i])]])
  cil.list[[i]]<-res.list[[as.character(MEASCAT[i])]]$ci.lb
  ciu.list[[i]]<-res.list[[as.character(MEASCAT[i])]]$ci.ub
  k.list[[i]]<-res.list[[as.character(MEASCAT[i])]]$k  
}
estimates<-unlist(est.list)
variances<-unlist(var.list)
cil<-unlist(cil.list)
ciu<-unlist(ciu.list)
ks<-unlist(k.list)
ggdf<-data.frame(MEASCAT, estimates, variances, cil, ciu, ks)
ggdf$overlap0<-ggdf$cil<0 & ggdf$ciu>0

#update effect size table for plotting with ggplot
ggdf$MEASCAT <- factor(ggdf$MEASCAT, levels = MEASCAT)
ggdf$y<-NA
CATl<-rev(levels(ggdf$MEASCAT))
i<-0
for(i in 1:length(CATl)){
  ggdf[ggdf$MEASCAT==CATl[i],'y']<-i  
}

#make ggplot plot
x.st<-ggdf[ggdf$MEASCAT=='littercn','ciu']
glob.sp<-ggplot(data=ggdf,aes(x=estimates,y=y, label=ks)) + 
  geom_point(size=3, show_guide=FALSE) +
  geom_errorbarh(aes(xmin=cil,xmax=ciu), height=0, show_guide=FALSE) +
  geom_vline(xintercept=0,linetype="dashed") + 
  mytheme + xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
  scale_y_continuous(breaks=seq(1,length(MEASCAT)),labels=rev(labels), 
                     limits=c(0.5,15.5), expand=c(0,0)) + 
  geom_text(aes(x=ciu, y=y, hjust=-0.5, vjust=0.5),size=2.2,show_guide = FALSE) + 
  annotate("segment", x = x.st, y = 1, xend = -3.2, yend = 1,
               arrow = arrow(length = unit(0.1,"in")), size=0.3) +
  xlim(-3.2,2.5) +
  geom_hline(yintercept=4.5,linetype="solid") +
  geom_hline(yintercept=7.5,linetype="solid") + 
  annotate("text", x=-Inf, y=15.2, label='Soil Nitrogen', hjust=-0.1, size=3) +
  annotate("text", x=-Inf, y=7.2, label='Ecosystem Properties', hjust=-0.1, size=3) +
  annotate("text", x=-Inf, y=4.2, label='Leaf Chemistry', hjust=-0.1, size=3) + 
  geom_text(aes(label=ifelse(overlap0==FALSE,"*", ""), hjust=-0.6, vjust=0.4), size=5)
glob.sp 

#save estimates and pvals
#res.list
i<-0
result.list<-list()
for (i in 1:length(res.list)){
  res<-res.list[[i]]
  p.val<-round(res$pval, 3)
  est<-round(res$b, 3)
  intraPaperCorr<-round(res$sigma2[1] / sum(res$sigma2), 3) #if this # is high, it means that the underlying true effects within paperIDs are estimated to correlate quite strongly
  Heterogen<-round(sum(res$sigma2), 3) #the sum of the two variance components can be interpreted as the total amount of heterogeneity in the true effects
  result.list[[i]]<-c(est, p.val, intraPaperCorr, Heterogen)
}
resultdf<-ldply(result.list, rbind.fill)
colnames(resultdf)<-c("est","pval","intraPaperCorr","heterogen")
resultdf<-cbind(labels, resultdf)
resultdf
```


#2. Effect size moderators

##A. Fit 3-level random-effects model and view likelihood plots  
Model syntax is res <- rma.mv(yi, vi, mods= ~factor(Xmod), random=list(~1 | paperID, ~1 | obsID), data=dat1, subset=measCat==MEASCAT[i], slab=paste(paperID,obsID, sep=","))  
where Xmod is one of the following: (1) Quality, (2) Ecosystem type, (3) Study type, (4) Invasive legumes present/absent, (5) Reference legumes present/absent
```{r extensionMod,echo=FALSE, warning=FALSE, message=FALSE}
dat.meas<-ddply(dat, ~obsID+measCat, summarize,
                yi = unique(yi),
                vi = unique(vi),
                paperID = unique(paperID),
                measQuality= unique(measQuality),
                ecosystCat= unique(ecosystCat),
                studyType= unique(studyType),
                Leg= unique(Leg))
dat.tmp<-dat.meas[dat.meas$measCat %in% MEASCAT,]

#look for singularities
temp<-ddply(dat.tmp, ~measCat+Leg, summarize, n=length(paperID))
temp
which(temp$n==1)
temp1<-ddply(temp, ~measCat, summarize, n=length(Leg))
temp1
legSing<-temp1[temp1$n==1,'measCat'] #singular ones
temp[temp$measCat %in% legSing,]

### fit 3-level random-effects models with a categorical mod
res.quality<-list()
res.ecosyst<-list()
res.studytype<-list()
res.Leg<-list()
i<-0
for(i in 1:length(MEASCAT)){
  subdat<-subset(dat.tmp, measCat==MEASCAT[i])
  res.quality[[i]]<- rma.mv(yi, vi, 
                            mods= ~factor(measQuality), 
                            random=list(~1 | paperID, ~1 | obsID), 
                            data=subdat, slab=as.character(obsID))
  res.ecosyst[[i]]<- rma.mv(yi, vi, 
                            mods= ~factor(ecosystCat), 
                            random=list(~1 | paperID, ~1 | obsID), 
                            data=subdat, slab=as.character(obsID))
  res.studytype[[i]]<- rma.mv(yi, vi, 
                              mods= ~factor(studyType), 
                              random=list(~1 | paperID, ~1 | obsID), 
                              data=subdat, slab=as.character(obsID))
  res.Leg[[i]]<- rma.mv(yi, vi, 
                           mods= ~factor(Leg), 
                           random=list(~1 | paperID, ~1 | obsID), 
                           data=subdat, slab=as.character(obsID))
  print(paste(i, 'of', length(MEASCAT)))
}
names(res.quality)<-MEASCAT
names(res.ecosyst)<-MEASCAT
names(res.studytype)<-MEASCAT
names(res.Leg)<-MEASCAT
#warnings() #these should all just say 'Rows with NAs omitted from model fitting' or 'Redundant predictors dropped from the model'

#View profile likelihood plots -- should be the same as without added mods
```

 ##B. Figure out which models are improved by the moderator
```{r extensionFindMod,echo=FALSE, warning=FALSE, message=FALSE}
#Test whether inclusion of any of these moderators are warrented
i<-0
tmp.list<-list()
for(i in 1:length(MEASCAT)){
  qualityA<-round(anova(res.quality[[i]])$QMp, 3)
  ecosystA<-round(anova(res.ecosyst[[i]])$QMp, 3)
  studytypeA<-round(anova(res.studytype[[i]])$QMp, 3)
  legA<-round(anova(res.Leg[[i]])$QMp, 3)
  tmp.list[[i]]<-data.frame(qualityA, ecosystA, studytypeA, legA)
  }
names(tmp.list)<-MEASCAT
anovaMods<-ldply(tmp.list)
anovaMods

source('rmdCode/resultsForest/fxn_FactorForests.R') 
```

##C. Plot Moderators
### Quality
```{r quality,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
currMeasFac<-anovaMods[anovaMods$qualityA < 0.1,'.id']
currMeasFac
result<-FactorForest(MeasFac=currMeasFac, res.fac=res.quality, dat.tmp=dat.tmp, facCol='measQuality')

#update effect size table for plotting
dfr<-ldply(result)
CAT<-rev(levels(unique(dfr$CAT)))
colnames(dfr)[1]<-'MeasFac'
selectMeas<-unique(dfr$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
dfr$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
  dfr[dfr$CAT==CAT[1] & dfr$MeasFac==MeasFacl[i],'y']<-i-0.2
  dfr[dfr$CAT==CAT[2] & dfr$MeasFac==MeasFacl[i],'y']<-i-0.1 
  dfr[dfr$CAT==CAT[3] & dfr$MeasFac==MeasFacl[i],'y']<-i+0.1
  dfr[dfr$CAT==CAT[4] & dfr$MeasFac==MeasFacl[i],'y']<-i+0.2 
}
CAT
faclimits<-rev(c('No Manip.','Units Converted','Values Aggregated','Units Converted &\nValues Aggregated'))
facShapes<-c(16,17,15,18)
dfr$overlap0<-dfr$cil<0 & dfr$ciu>0

#ggplot
qual.sp<-ggplot(data=dfr,aes(x=estimates,y=y, shape=CAT, label=ks)) + 
  geom_point(aes(shape=CAT),size=3) +
  geom_errorbarh(aes(xmin=cil,xmax=ciu), height=0)+
  geom_vline(xintercept=0,linetype="dashed") + mytheme +
  xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
  scale_y_continuous(breaks=seq(1,length(MeasFacl)),
                     labels=MeasNamesl, expand=c(0,0), limits=c(0.5,7.5)) +
  scale_shape_manual(name="Factor",
                     labels=faclimits,
                     values=facShapes)+
  geom_text(aes(x=ciu, y=y, hjust=-1, vjust=0.5),size=2.2,show_guide = FALSE) +
  geom_hline(yintercept=3.5,linetype="solid") +
  geom_hline(yintercept=5.5,linetype="solid") + 
  annotate("text", x=-9, y=7.3, label='Soil\nNitrogen', hjust=-0.1, size=3) +
  annotate("text", x=-9, y=5.3, label='Ecosystem\nProperties', hjust=-0.1, size=3) +
  annotate("text", x=-9, y=3.3, label='Leaf\nChemistry', hjust=-0.1, size=3) +
  scale_x_continuous(expand=c(0,0), limits=c(-9,8)) + 
  geom_text(aes(label=ifelse(overlap0==FALSE,"*", ""), hjust=-0.6, vjust=0.4), size=5)
qual.sp
dfr
```
### Ecosystem type
```{r ecosyst,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
#source('rmdCode/resultsForest/script_ecosystPlot.R') 
#ecosystem
currMeasFac<-anovaMods[anovaMods$ecosystA < 0.1,'.id']
currMeasFac
result<-FactorForest(MeasFac=currMeasFac, res.fac=res.ecosyst, dat.tmp, facCol='ecosystCat')

#update effect size table for plotting
dfr<-ldply(result)
CAT<-rev(levels(unique(dfr$CAT)))
colnames(dfr)[1]<-'MeasFac'
selectMeas<-unique(dfr$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
dfr$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
  dfr[dfr$CAT==CAT[2] & dfr$MeasFac==MeasFacl[i],'y']<-i-0.2
  dfr[dfr$CAT==CAT[3] & dfr$MeasFac==MeasFacl[i],'y']<-i-0.1 
  dfr[dfr$CAT==CAT[4] & dfr$MeasFac==MeasFacl[i],'y']<-i+0.1
  dfr[dfr$CAT==CAT[5] & dfr$MeasFac==MeasFacl[i],'y']<-i+0.2 
}
CAT
faclimits<-rev(c('Wetland','Grassland','Shrubland','Forest'))
facShapes<-c(16,17,15,18)
length(MeasFacl)
dfr$overlap0<-dfr$cil<0 & dfr$ciu>0

#ggplot
eco.sp<-ggplot(data=dfr,aes(x=estimates,y=y, shape=CAT, label=ks)) + 
  geom_point(aes(shape=CAT),size=3) +
  geom_errorbarh(aes(xmin=cil,xmax=ciu), height=0)+
  geom_vline(xintercept=0,linetype="dashed") + mytheme +
  xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
  scale_y_continuous(breaks=seq(1,length(MeasFacl)),
                     labels=MeasNamesl, expand=c(0,0), limits=c(0.5,length(MeasFacl)+0.5)) +
  scale_shape_manual(name="Factor",
                     labels=faclimits,
                     values=facShapes)+
  geom_text(aes(x=ciu, y=y, hjust=-1, vjust=0.5),size=2.2,show_guide = FALSE) +
  geom_hline(yintercept=1.5,linetype="solid") +
  annotate("text", x=-1.2, y=3.3, label='Soil Nitrogen', hjust=-0.1, size=3) +
  annotate("text", x=-1.2, y=1.3, label='Ecosystem Properties', hjust=-0.1, size=3) +
  scale_x_continuous(expand=c(0,0), limits=c(-1.2,2))+ 
  geom_text(aes(label=ifelse(overlap0==FALSE,"*", ""), hjust=-0.6, vjust=0.4), size=5)
eco.sp
dfr
```
### Study type
```{r studytype,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
currMeasFac<-anovaMods[anovaMods$studytypeA < 0.1,'.id']
currMeasFac
result<-FactorForest(MeasFac=currMeasFac,res.fac=res.studytype, dat.tmp, facCol='studyType')

#update effect size table for plotting
dfr<-ldply(result)
CAT<-rev(levels(unique(dfr$CAT)))
colnames(dfr)[1]<-'MeasFac'
selectMeas<-unique(dfr$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
dfr$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
  dfr[dfr$CAT==CAT[1] & dfr$MeasFac==MeasFacl[i],'y']<-i-0.2 
  dfr[dfr$CAT==CAT[2] & dfr$MeasFac==MeasFacl[i],'y']<-i-0.1 
  dfr[dfr$CAT==CAT[3] & dfr$MeasFac==MeasFacl[i],'y']<-i+0.1
  dfr[dfr$CAT==CAT[4] & dfr$MeasFac==MeasFacl[i],'y']<-i+0.2 
}
CAT
faclimits<-rev(c('Greenhouse\nExpt',
             'Field Expt\nRemoval',
             'Field Expt\nAddition',
             'Field Study'))
facShapes<-c(16,17,15,18)
dfr$overlap0<-dfr$cil<0 & dfr$ciu>0

#ggplot
stud.sp<-ggplot(data=dfr,aes(x=estimates,y=y, shape=CAT, label=ks)) + 
  geom_point(aes(shape=CAT),size=3) +
  geom_errorbarh(aes(xmin=cil,xmax=ciu), height=0)+
  geom_vline(xintercept=0,linetype="dashed") + mytheme +
  xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
  scale_y_continuous(breaks=c(1,2,3),labels=MeasNamesl) +
  scale_shape_manual(name="Factor",
                     labels=faclimits,
                     values=facShapes)+
  geom_text(aes(x=ciu, y=y, hjust=-1, vjust=0.5),size=2.2,show_guide = FALSE) +
  geom_hline(yintercept=2.5,linetype="solid") +
  annotate("text", x=-2.5, y=3.3, label='Soil\nNitrogen', hjust=-0.1, size=3) +
  annotate("text", x=-2.5, y=2.3, label='Ecosystem\nProperties', hjust=-0.1, size=3) +
  scale_x_continuous(expand=c(0,0), limits=c(-2.5,5.5))+ 
  geom_text(aes(label=ifelse(overlap0==FALSE,"*", ""), hjust=-0.6, vjust=0.4), size=5)
stud.sp
dfr

```
### Invasive legume present/absent, Reference legumen present/absent
```{r legume,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
currMeasFac<-anovaMods[anovaMods$legA < 0.1,'.id']
currMeasFac
result<-FactorForest(MeasFac=currMeasFac, res.fac=res.Leg, dat.tmp=dat.tmp, facCol='Leg')

#update effect size table for plotting
dfr<-ldply(result)
CAT<-rev(levels(unique(dfr$CAT)))
colnames(dfr)[1]<-'MeasFac'
selectMeas<-unique(dfr$MeasFac)
MeasFacl<-rev(levels(factor(MEASCAT[MEASCAT %in% selectMeas], levels=MEASCAT[MEASCAT %in% selectMeas])))
MeasNamesl<-rev(measTab[measTab$MEASCAT %in% selectMeas,'labels'])
dfr$y<-NA
i<-0
for(i in 1:length(MeasFacl)){
  dfr[dfr$CAT==CAT[1] & dfr$MeasFac==MeasFacl[i],'y']<-i-0.2
  dfr[dfr$CAT==CAT[2] & dfr$MeasFac==MeasFacl[i],'y']<-i-0.1 
  dfr[dfr$CAT==CAT[3] & dfr$MeasFac==MeasFacl[i],'y']<-i+0.1
  dfr[dfr$CAT==CAT[4] & dfr$MeasFac==MeasFacl[i],'y']<-i+0.2 
}
CAT
faclimits<-rev(c('Inv+,Ref+','Inv+,Ref-','Inv-,Ref+','Inv-,Ref-'))
facShapes<-c(16,17,15,18)
dfr$overlap0<-dfr$cil<0 & dfr$ciu>0

#ggplot
leg.sp<-ggplot(data=dfr,aes(x=estimates,y=y, shape=CAT, label=ks)) + 
  geom_point(aes(shape=CAT),size=3) +
  geom_errorbarh(aes(xmin=cil,xmax=ciu), height=0)+
  geom_vline(xintercept=0,linetype="dashed") + mytheme +
  xlab('Std. Mean Diff. (Inv-Ref)') + ylab('') +
  scale_y_continuous(breaks=seq(1,length(MeasFacl)),
                     labels=MeasNamesl) +
  scale_shape_manual(name="Factor",
                     labels=faclimits,
                     values=facShapes)+
  geom_text(aes(x=ciu, y=y, hjust=-1, vjust=0.5),size=2.2,show_guide = FALSE) +
  geom_hline(yintercept=2.5,linetype="solid") +
  geom_hline(yintercept=1.5,linetype="solid") + 
  annotate("text", x=-2.5, y=5.3, label='Soil\nNitrogen', hjust=-0.1, size=3) +
  annotate("text", x=-2.5, y=2.3, label='Ecosystem\nProperties', hjust=-0.1, size=3) +
  annotate("text", x=-2.5, y=1.3, label='Leaf\nChemistry', hjust=-0.1, size=3) +
  scale_x_continuous(expand=c(0,0), limits=c(-2.5,4))+ 
  geom_text(aes(label=ifelse(overlap0==FALSE,"*", ""), hjust=-0.6, vjust=0.4), size=5)
leg.sp
dfr

```

#3. Save Figures 

##A. Figure 1
```{r fig1,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
filename<-"fig1.png"
mypath<-file.path("/Users/mrl17/Documents/duke/wrightlab/projects/MetaInvN_Spring2011/MIIN_repository", "figures", filename)
png(mypath, units='in', width = 4, height = 6, res=300)
glob.sp
dev.off()
```
![alt text](figures/fig1.png)  
\pagebreak

##B. Figure 2
```{r fig2,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
filename<-"fig2.png"
mypath<-file.path("/Users/mrl17/Documents/duke/wrightlab/projects/MetaInvN_Spring2011/MIIN_repository", "figures", filename)
png(mypath, units='in', width = 5, height = 4, res=300)
stud.sp
dev.off()
```
![alt text](figures/fig2.png)  
\pagebreak  

##B. Figure 3
```{r fig3,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
filename<-"fig3.png"
mypath<-file.path("/Users/mrl17/Documents/duke/wrightlab/projects/MetaInvN_Spring2011/MIIN_repository", "figures", filename)
png(mypath, units='in', width = 5, height = 6.5, res=300)
leg.sp
dev.off()
```
![alt text](figures/fig3.png)  
\pagebreak  

##B. Quality Forest Plot
```{r qualityfig,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
filename<-"forest_quality.png"
mypath<-file.path("/Users/mrl17/Documents/duke/wrightlab/projects/MetaInvN_Spring2011/MIIN_repository", "figures", filename)
png(mypath, units='in', width = 5, height = 6.5, res=300)
qual.sp
dev.off()
```
![alt text](figures/forest_quality.png)  
\pagebreak

##B. Ecosytem Forest Plot
```{r ecosystemfig,echo=FALSE, warning=FALSE, message=FALSE, fig.show='hide'}
filename<-"forest_ecosystem.png"
mypath<-file.path("/Users/mrl17/Documents/duke/wrightlab/projects/MetaInvN_Spring2011/MIIN_repository", "figures", filename)
png(mypath, units='in', width = 5, height = 4, res=300)
eco.sp
dev.off()
```
![alt text](figures/forest_ecosystem.png)  
\pagebreak  




